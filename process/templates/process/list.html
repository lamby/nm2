{% extends "nm-base.html" %}
{% load nm %}
{% load js %}

{% block head_resources %}
  {{block.super}}
  {% jsinclude "tables" %}
  {% jsinclude "nm" %}
{% endblock %}

{% block head %}
{{block.super}}
<script type="text/javascript">
$(function() {
    $(".proctable").tablesorter({
        textExtraction: function(node) {
            val = node.getAttribute("val");
            if (val == null)
                val = node.textContent || node.innerText;
            return val;
        },
    });
});
</script>
{% endblock %}

{% block content %}

<h1>Processes currently open</h1>

<table class="proctable tablesorter">
<thead>
    <tr>
        <th>Applicant</th>
        <th>Applicant uid</th>
        <th>Applying for</th>
        <th>First change</th>
        <th>Last change</th>
        <th>Requirements ok</th>
        <th>Requirements missing</th>
        {% if visitor.is_admin %}
        <th>FD comments</th>
        {% endif %}
    </tr>
</thead>
<tbody>
    {% for p in current %}
    <tr>
        {% with p.compute_status as status %}
        <td><a href="{{ p.get_absolute_url }}">{{p.person.fullname}}</a></td>
        <td><a href="{{ p.get_absolute_url }}">{{p.person.uid}}</a></td>
        <td val="{{ p.applying_for|seq_status }}">{{p.applying_for|desc_status}}</td>
        <td>{{status.log_first.logdate|date:"Y-m-d"}}</td>
        <td>{{status.log_last.logdate|date:"Y-m-d"}}</td>
        <td>
          {% for req in status.requirements_ok %}
          <a href="{{req.get_absolute_url}}">{{req.type}}</a>
          {% endfor %}
        </td>
        <td>
          {% for req in status.requirements_missing %}
          <a href="{{req.get_absolute_url}}">{{req.type}}</a>
          {% endfor %}
        </td>
        {% if visitor.is_admin %}
        <td>{{p.fd_comment}}</td>
        {% endif %}
        {% endwith %}
    </tr>
    {% endfor %}
</tbody>
</table>

<h1>Processes closed in the last 30 days</h1>

<table class="proctable tablesorter">
<thead>
    <tr>
        <th>Applicant</th>
        <th>Applicant uid</th>
        <th>Applying for</th>
        <th>First change</th>
        <th>Last change</th>
        <th>Requirements ok</th>
        <th>Requirements missing</th>
        {% if visitor.is_admin %}
        <th>FD comments</th>
        {% endif %}
    </tr>
</thead>
<tbody>
    {% for p in last %}
    <tr>
        {% with p.compute_status as status %}
        <td><a href="{{ p.get_absolute_url }}">{{p.person.fullname}}</a></td>
        <td><a href="{{ p.get_absolute_url }}">{{p.person.uid}}</a></td>
        <td val="{{ p.applying_for|seq_status }}">{{p.applying_for|desc_status}}</td>
        <td>{{status.log_first.logdate|date:"Y-m-d"}}</td>
        <td>{{status.log_last.logdate|date:"Y-m-d"}}</td>
        <td>
          {% for req in status.requirements_ok %}
          <a href="{{req.get_absolute_url}}">{{req.type}}</a>
          {% endfor %}
        </td>
        <td>
          {% for req in status.requirements_missing %}
          <a href="{{req.get_absolute_url}}">{{req.type}}</a>
          {% endfor %}
        </td>
        {% if visitor.is_admin %}
        <td>{{p.fd_comment}}</td>
        {% endif %}
        {% endwith %}
    </tr>
    {% endfor %}
</tbody>
</table>

{% endblock %}

